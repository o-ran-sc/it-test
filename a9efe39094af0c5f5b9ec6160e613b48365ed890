{
  "comments": [
    {
      "key": {
        "uuid": "34808161_470c2626",
        "filename": "ric_robot_suite/helm/ric-robot/ete-k8s.e2sim.sh",
        "patchSetId": 1
      },
      "lineNbr": 73,
      "author": {
        "id": 1000047
      },
      "writtenOn": "2019-09-06T02:37:20Z",
      "side": 1,
      "message": "this is probably totally unnecessary, but would it make sense, rather than checking for the pods, to look at the deployments instead?  something like:\n\nkubectl -n ${NAMESPACE} get deployment ${DEPLOYMENT} \\\n         -o template \\                                                                                                              \n         --template\u003d \\\n        \u0027{{if (or .status.readyReplicas 0) | eq .status.replicas}}READY{{else}}NOTREADY{{end}}\u0027\n\n.. in a loop with a sleep 1 for timeout purposes.  that way if a deployment has more than one pod, you don\u0027t try to hit it until they\u0027re all running.\n\nagain, probably pedantic and unnecessary, but a bit more elegant.",
      "revId": "a9efe39094af0c5f5b9ec6160e613b48365ed890",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2ed6e966_326bb35e",
        "filename": "ric_robot_suite/helm/ric-robot/ete-k8s.e2sim.sh",
        "patchSetId": 1
      },
      "lineNbr": 73,
      "author": {
        "id": 1000048
      },
      "writtenOn": "2019-09-06T15:52:43Z",
      "side": 1,
      "message": "Not sure that handles the case of statefulsets but I\u0027m more use to checking the number of running pods (and the scripts I stole this snippet from did that) - I agree its more elegant. I\u0027d like to get more comfortable with it and make sure thnings like statefulset are handled then we can change it.",
      "parentUuid": "34808161_470c2626",
      "revId": "a9efe39094af0c5f5b9ec6160e613b48365ed890",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ee96a36a_c708fbde",
        "filename": "ric_robot_suite/helm/ric-robot/ete-k8s.e2sim.sh",
        "patchSetId": 1
      },
      "lineNbr": 73,
      "author": {
        "id": 1000047
      },
      "writtenOn": "2019-09-09T14:08:20Z",
      "side": 1,
      "message": "belatedly: yeah, this assumes deployment-controlled pods, but the statefulset version is the same basic idea, just fetching the statefulset (or daemonset, for that matter) instead.  while it\u0027s possible to build a single \"wait-for\" function that handles any of these (one approach is to chase \"controlled-by\" links up the tree of controlling objects) it\u0027s probably simplest just to have a wait-for-{deployment,statefulset,daemonset,...} and call the one for what you know is at the root of the tree.  i do think that in general that\u0027s what you kinda need to do as you probably shouldn\u0027t assume things are working until all pods associated with a controlling object are working.\n\nbut also, as i said, i\u0027m being a pedantic here â€” this is a hobby-horse of mine.  this works fine for now.",
      "parentUuid": "2ed6e966_326bb35e",
      "revId": "a9efe39094af0c5f5b9ec6160e613b48365ed890",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa4a7543_041c1e6e",
        "filename": "ric_robot_suite/helm/ric-robot/ete-k8s.e2sim.sh",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1000047
      },
      "writtenOn": "2019-09-06T02:37:20Z",
      "side": 1,
      "message": "like above, maybe this is unnecessary, but sleeping 15 seems like it may fail sometimes.  would it be possible to bang requests (using curl, for example) off the e2mgr until it respons sensibly?",
      "revId": "a9efe39094af0c5f5b9ec6160e613b48365ed890",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d7e67a2_f2eced57",
        "filename": "ric_robot_suite/helm/ric-robot/ete-k8s.e2sim.sh",
        "patchSetId": 1
      },
      "lineNbr": 157,
      "author": {
        "id": 1000048
      },
      "writtenOn": "2019-09-06T15:52:43Z",
      "side": 1,
      "message": "I dont like it either but it was the simplest. it seems strange to use curl when robot is going to do an http post after this step. I think part of the problem is my VM is getting over loaded with all the pods running so things are generaly slower on it. let me try a wait_for_e2mgr with curl and see if I can do something simple as you suggest that would be less sensitive to a specific timer",
      "parentUuid": "aa4a7543_041c1e6e",
      "revId": "a9efe39094af0c5f5b9ec6160e613b48365ed890",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53",
      "unresolved": true
    }
  ]
}